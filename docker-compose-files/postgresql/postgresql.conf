#
# PostgreSQL configuration file
# This file sets global options for the PostgreSQL server.
# Configuration files are usually located in /etc/postgresql/ or /var/lib/postgresql/data/
# See https://www.postgresql.org/docs/current/runtime-config.html for details.
#

# ============================================
# Connection Settings
# ============================================

listen_addresses = '*'                # Accept connections from any IP address
port = 5432                           # Default PostgreSQL port
max_connections = 200                 # Max concurrent client connections

# ============================================
# File Locations
# ============================================

data_directory = '/var/lib/postgresql/data'  # Main database directory
hba_file = '/etc/postgresql/pg_hba.conf'     # Host-based authentication file
ident_file = '/etc/postgresql/pg_ident.conf' # User mapping file

# ============================================
# Logging and Diagnostics
# ============================================

logging_collector = on               # Enable capturing logs to files
log_directory = 'log'                # Log output folder (relative to data dir)
log_filename = 'postgresql.log'      # Log file name
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '  # Log format
log_min_messages = warning           # Minimum severity level to log
log_min_error_statement = error      # Log only erroneous statements
log_min_duration_statement = 500     # Log queries slower than 500ms

# ============================================
# Locale and Timezone
# ============================================

timezone = 'Europe/Amsterdam'        # System timezone
lc_messages = 'en_US.UTF-8'          # Locale for messages
lc_monetary = 'en_US.UTF-8'          # Monetary formatting
lc_numeric = 'en_US.UTF-8'           # Numeric formatting
lc_time = 'en_US.UTF-8'              # Date and time formatting

# ============================================
# Memory Settings
# ============================================

shared_buffers = 512MB               # Memory for caching data blocks
work_mem = 4MB                       # Memory for internal operations per connection
maintenance_work_mem = 64MB          # Memory for maintenance tasks (e.g., VACUUM)
effective_cache_size = 1GB           # OS cache size estimate

# ============================================
# Write-Ahead Logging (WAL)
# ============================================

wal_level = replica                  # Enable WAL for replication/backups
synchronous_commit = on              # Ensure durability on every commit
wal_buffers = 16MB                   # Memory for WAL
checkpoint_timeout = 5min            # Maximum interval between checkpoints
max_wal_size = 1GB                   # Max WAL before checkpoint
min_wal_size = 80MB                  # Minimum WAL retained

# ============================================
# Background Writer
# ============================================

bgwriter_delay = 200ms               # Delay between writes
bgwriter_lru_maxpages = 100          # Max pages per write round

# ============================================
# Query Planner & Optimizer
# ============================================

default_statistics_target = 100      # Statistic sample size for planner
random_page_cost = 1.1               # Disk access cost factor
effective_io_concurrency = 200       # Parallel I/O operations supported

# ============================================
# Authentication & Security
# ============================================

password_encryption = scram-sha-256  # Strong password hashing
ssl = off                            # Enable SSL if certificates are configured

# ============================================
# Replication Settings (optional)
# ============================================

# max_wal_senders = 5                # Max replication connections
# wal_keep_size = 64MB               # Keep enough WAL for standby
# hot_standby = on                   # Allow queries on replica

# ============================================
# Extensions and Plugins (optional)
# ============================================

# shared_preload_libraries = 'pg_stat_statements'   # Load extension at startup
# pg_stat_statements.track = all                    # Track all SQL statements

# ============================================
# Additional Configuration Files
# ============================================

# include = '/etc/postgresql/conf.d/custom.conf'    # Include external config
